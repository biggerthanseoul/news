<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>영어 단어장 - 슬라이딩 뷰</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid #ddd;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .instructions {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .card-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .unit-title {
            background-color: #2c3e50;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 20px 0 10px 0;
        }
        
        .word-card {
            position: relative;
            height: 120px;
            perspective: 1000px;
            cursor: pointer;
        }
        
        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        
        .card-side {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .pronunciation {
            background-color: #3498db;
            color: white;
            transform: rotateY(-180deg);
        }
        
        .word {
            background-color: white;
            z-index: 2;
        }
        
        .meaning {
            background-color: #2ecc71;
            color: white;
            transform: rotateY(180deg);
        }
        
        .show-pronunciation .card {
            transform: rotateY(-180deg);
        }
        
        .show-meaning .card {
            transform: rotateY(180deg);
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .swipe-instruction {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        @media (max-width: 600px) {
            .word-card {
                height: 100px;
            }
            
            .card-side {
                font-size: 1rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>영어 단어장</h1>
        <p>슬라이딩 뷰로 학습하세요</p>
    </header>
    
    <div class="instructions">
        <p><strong>사용 방법:</strong></p>
        <ul>
            <li>기본 화면에서는 영어 단어가 보입니다.</li>
            <li>카드를 <strong>왼쪽</strong>으로 슬라이드하면 <strong>발음 기호</strong>가 보입니다.</li>
            <li>카드를 <strong>오른쪽</strong>으로 슬라이드하면 <strong>한글 뜻</strong>이 보입니다.</li>
            <li>카드를 탭하면 다시 영어 단어로 돌아갑니다.</li>
        </ul>
    </div>
    
    <div class="swipe-instruction">
        <span>◀ 왼쪽으로 슬라이드: 발음 기호</span>
        <span>오른쪽으로 슬라이드: 한글 뜻 ▶</span>
    </div>
    
    <div id="card-container" class="card-container">
        <!-- 자바스크립트로 카드가 여기에 추가됩니다 -->
    </div>
    
    <div class="controls">
        <button id="reset-btn">처음으로</button>
        <button id="toggle-view-btn">보기 방식 변경</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // 하드코딩된 데이터
        const vocabularyData = [
            { unit: "Unit 1: Special Days", word: "Valentine's Day", pronunciation: "/ˈvæləntaɪnz deɪ/", meaning: "발렌타인 데이" },
            { unit: "Unit 1: Special Days", word: "Earth Day", pronunciation: "/ɜːrθ deɪ/", meaning: "지구의 날" },
            { unit: "Unit 1: Special Days", word: "Mother's Day", pronunciation: "/ˈmʌðərz deɪ/", meaning: "어머니의 날" },
            { unit: "Unit 1: Special Days", word: "Thanksgiving", pronunciation: "/ˌθæŋksˈɡɪvɪŋ/", meaning: "추수감사절" },
            { unit: "Unit 1: Special Days", word: "Halloween", pronunciation: "/ˌhæləˈwiːn/", meaning: "할로윈" },
            { unit: "Unit 1: Special Days", word: "Christmas Day", pronunciation: "/ˈkrɪsməs deɪ/", meaning: "크리스마스" },
            { unit: "Unit 1: Special Days", word: "favorite", pronunciation: "/ˈfeɪvərɪt/", meaning: "가장 좋아하는" },
            { unit: "Unit 1: Special Days", word: "day", pronunciation: "/deɪ/", meaning: "날" },
            { unit: "Unit 1: Special Days", word: "my", pronunciation: "/maɪ/", meaning: "나의" },
            { unit: "Unit 1: Special Days", word: "his", pronunciation: "/hɪz/", meaning: "그의" },
            { unit: "Unit 1: Special Days", word: "her", pronunciation: "/hɜːr/", meaning: "그녀의" },
            { unit: "Unit 1: Special Days", word: "what", pronunciation: "/wɑːt/", meaning: "무엇" },
            { unit: "Unit 1: Special Days", word: "look", pronunciation: "/lʊk/", meaning: "보다" },
            { unit: "Unit 1: Special Days", word: "number", pronunciation: "/ˈnʌmbər/", meaning: "번호" },
            { unit: "Unit 1: Special Days", word: "decode", pronunciation: "/diːˈkoʊd/", meaning: "해독하다" },
            { unit: "Unit 2: People", word: "chef", pronunciation: "/ʃef/", meaning: "요리사" },
            { unit: "Unit 2: People", word: "pilot", pronunciation: "/ˈpaɪlət/", meaning: "비행기 조종사" },
            { unit: "Unit 2: People", word: "photographer", pronunciation: "/fəˈtɑːɡrəfər/", meaning: "사진사" },
            { unit: "Unit 2: People", word: "police officer", pronunciation: "/pəˈliːs ˈɔːfɪsər/", meaning: "경찰관" },
            { unit: "Unit 2: People", word: "nurse", pronunciation: "/nɜːrs/", meaning: "간호사" },
            { unit: "Unit 2: People", word: "firefighter", pronunciation: "/ˈfaɪərfaɪtər/", meaning: "소방관" },
            { unit: "Unit 2: People", word: "farmer", pronunciation: "/ˈfɑːrmər/", meaning: "농부" },
            { unit: "Unit 2: People", word: "server", pronunciation: "/ˈsɜːrvər/", meaning: "서버, 웨이터" },
            { unit: "Unit 2: People", word: "actor", pronunciation: "/ˈæktər/", meaning: "배우" },
            { unit: "Unit 2: People", word: "musician", pronunciation: "/mjuˈzɪʃn/", meaning: "음악가" },
            { unit: "Unit 3: Food", word: "pasta", pronunciation: "/ˈpɑːstə/", meaning: "파스타" },
            { unit: "Unit 3: Food", word: "bread", pronunciation: "/bred/", meaning: "빵" },
            { unit: "Unit 3: Food", word: "rice", pronunciation: "/raɪs/", meaning: "쌀" },
            { unit: "Unit 3: Food", word: "vegetable", pronunciation: "/ˈvedʒtəbl/", meaning: "채소" },
            { unit: "Unit 3: Food", word: "fruit", pronunciation: "/fruːt/", meaning: "과일" },
            { unit: "Unit 3: Food", word: "meat", pronunciation: "/miːt/", meaning: "고기" },
            { unit: "Unit 3: Food", word: "seafood", pronunciation: "/ˈsiːfuːd/", meaning: "해산물" },
            { unit: "Unit 3: Food", word: "dessert", pronunciation: "/dɪˈzɜːrt/", meaning: "디저트" },
            { unit: "Unit 4: Activities", word: "swimming", pronunciation: "/ˈswɪmɪŋ/", meaning: "수영" },
            { unit: "Unit 4: Activities", word: "running", pronunciation: "/ˈrʌnɪŋ/", meaning: "달리기" },
            { unit: "Unit 4: Activities", word: "hiking", pronunciation: "/ˈhaɪkɪŋ/", meaning: "등산" },
            { unit: "Unit 4: Activities", word: "cycling", pronunciation: "/ˈsaɪklɪŋ/", meaning: "자전거 타기" },
            { unit: "Unit 4: Activities", word: "cooking", pronunciation: "/ˈkʊkɪŋ/", meaning: "요리하기" },
            { unit: "Unit 4: Activities", word: "reading", pronunciation: "/ˈriːdɪŋ/", meaning: "독서" },
            { unit: "Unit 4: Activities", word: "traveling", pronunciation: "/ˈtrævəlɪŋ/", meaning: "여행" },
            { unit: "Unit 4: Activities", word: "painting", pronunciation: "/ˈpeɪntɪŋ/", meaning: "그림 그리기" }
        ];
        
        // 엑셀 데이터 가져오기 함수 (오류 발생시 하드코딩된 데이터 사용)
        async function loadVocabularyData() {
            try {
                // 파일이 존재하면 파일에서 데이터 로드 시도
                if (typeof window.fs !== 'undefined') {
                    const response = await window.fs.readFile('english.xlsx');
                    
                    // 엑셀 파일 파싱
                    const workbook = XLSX.read(response, {
                        cellStyles: true,
                        cellFormulas: true,
                        cellDates: true,
                        cellNF: true,
                        sheetStubs: true
                    });
                    
                    // 첫 번째 시트 가져오기
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // 데이터를 JSON으로 변환
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    // 단어 데이터 추출
                    let wordData = [];
                    let currentUnit = "";
                    let headerRowIndex = -1;
                    
                    // 헤더 행 찾기
                    for (let i = 0; i < jsonData.length; i++) {
                        if (jsonData[i] && jsonData[i].length >= 3) {
                            const rowStr = JSON.stringify(jsonData[i]);
                            if (rowStr.includes("영어 단어") && rowStr.includes("발음 기호") && rowStr.includes("한글 뜻")) {
                                headerRowIndex = i;
                                break;
                            }
                        }
                    }
                    
                    if (headerRowIndex === -1) {
                        throw new Error("헤더 행을 찾을 수 없습니다");
                    }
                    
                    // 데이터 추출
                    for (let i = 0; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        
                        // 빈 행 건너뛰기
                        if (!row || row.length === 0) continue;
                        
                        // 헤더 행 이전의 데이터 처리 (유닛 제목 찾기)
                        if (i < headerRowIndex) {
                            if (row[0] && row[0].includes("Unit")) {
                                currentUnit = row[0];
                            }
                            continue;
                        }
                        
                        // 헤더 행 건너뛰기
                        if (i === headerRowIndex) continue;
                        
                        // 새로운 유닛 제목 발견
                        if (row[0] && row[0].includes("Unit")) {
                            currentUnit = row[0];
                            continue;
                        }
                        
                        // 단어 데이터 추가
                        if (row[0]) {
                            wordData.push({
                                unit: currentUnit,
                                word: row[0],
                                pronunciation: row[1] || "",
                                meaning: row[2] || ""
                            });
                        }
                    }
                    
                    console.log("엑셀에서 로드된 단어 데이터:", wordData.length);
                    return wordData.length > 0 ? wordData : vocabularyData;
                } else {
                    console.log("window.fs 사용 불가: 하드코딩된 데이터 사용");
                    return vocabularyData;
                }
            } catch (error) {
                console.error("데이터 로딩 오류:", error);
                console.log("오류로 인해 하드코딩된 데이터 사용");
                return vocabularyData;
            }
        }

        // 카드 생성 함수
        function createWordCards(data) {
            const container = document.getElementById('card-container');
            container.innerHTML = ''; // 컨테이너 비우기
            
            let currentUnit = "";
            
            data.forEach((item, index) => {
                // 새로운 유닛 제목 추가
                if (item.unit && item.unit !== currentUnit) {
                    currentUnit = item.unit;
                    const unitTitle = document.createElement('h2');
                    unitTitle.className = 'unit-title';
                    unitTitle.textContent = currentUnit;
                    container.appendChild(unitTitle);
                }
                
                // 단어 카드 생성
                const wordCard = document.createElement('div');
                wordCard.className = 'word-card';
                wordCard.dataset.index = index;
                
                wordCard.innerHTML = `
                    <div class="card">
                        <div class="card-side pronunciation">${item.pronunciation}</div>
                        <div class="card-side word">${item.word}</div>
                        <div class="card-side meaning">${item.meaning}</div>
                    </div>
                `;
                
                container.appendChild(wordCard);
            });
            
            // 카드 클릭 이벤트 추가
            const cards = document.querySelectorAll('.word-card');
            cards.forEach(card => {
                // 터치 이벤트 설정
                let touchStartX = 0;
                let touchEndX = 0;
                
                card.addEventListener('touchstart', e => {
                    touchStartX = e.changedTouches[0].screenX;
                });
                
                card.addEventListener('touchend', e => {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe(card, touchStartX, touchEndX);
                });
                
                // 마우스 이벤트 설정
                let mouseStartX = 0;
                let mouseEndX = 0;
                let isMouseDown = false;
                
                card.addEventListener('mousedown', e => {
                    isMouseDown = true;
                    mouseStartX = e.screenX;
                });
                
                card.addEventListener('mouseup', e => {
                    if (isMouseDown) {
                        mouseEndX = e.screenX;
                        handleSwipe(card, mouseStartX, mouseEndX);
                    }
                    isMouseDown = false;
                });
                
                // 클릭 이벤트 (카드 초기화용)
                card.addEventListener('click', e => {
                    // 슬라이드가 아닌 클릭인 경우
                    if (Math.abs(mouseStartX - mouseEndX) < 10) {
                        resetCard(card);
                    }
                });
            });
        }
        
        // 카드 슬라이드 처리
        function handleSwipe(card, startX, endX) {
            const swipeThreshold = 50;
            const diff = startX - endX;
            
            // 슬라이드 방향에 따라 처리
            if (Math.abs(diff) > swipeThreshold) {
                resetAllCards();
                if (diff > 0) {
                    // 왼쪽으로 슬라이드: 발음 보기
                    card.classList.add('show-pronunciation');
                } else {
                    // 오른쪽으로 슬라이드: 뜻 보기
                    card.classList.add('show-meaning');
                }
            }
        }
        
        // 모든 카드 초기화
        function resetAllCards() {
            const cards = document.querySelectorAll('.word-card');
            cards.forEach(card => {
                card.classList.remove('show-pronunciation', 'show-meaning');
            });
        }
        
        // 개별 카드 초기화
        function resetCard(card) {
            card.classList.remove('show-pronunciation', 'show-meaning');
        }
        
        // 초기화 버튼 이벤트
        document.getElementById('reset-btn').addEventListener('click', resetAllCards);
        
        // 보기 방식 변경 버튼
        let viewMode = 'default';
        document.getElementById('toggle-view-btn').addEventListener('click', () => {
            const container = document.getElementById('card-container');
            
            if (viewMode === 'default') {
                viewMode = 'list';
                container.style.display = 'block';
                document.querySelectorAll('.word-card').forEach(card => {
                    card.style.height = 'auto';
                    card.style.marginBottom = '20px';
                });
            } else {
                viewMode = 'default';
                container.style.display = 'flex';
                document.querySelectorAll('.word-card').forEach(card => {
                    card.style.height = '120px';
                    card.style.marginBottom = '0';
                });
            }
        });
        
        // 페이지 로드 시 단어 데이터 가져오기
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const data = await loadVocabularyData();
                console.log("데이터 로딩 완료:", data.length, "개의 단어");
                createWordCards(data);
            } catch (error) {
                console.error("데이터 로딩 및 카드 생성 오류:", error);
                createWordCards(vocabularyData); // 오류 발생 시 하드코딩된 데이터 사용
            }
        });
    </script>
</body>
</html>
